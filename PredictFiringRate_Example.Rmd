---
title: "Example_predictFiringRate"
author: "Sarah Tennant"
date: "14/05/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```





1. We want to run this on an example cluster. So make tibble with example cluster manually identified as a distance encoding cell.  

```{r}
df <- tibble(Rates = as.numeric(unlist(predict_reset[12,]$asr_b_rewarded[[1]][1])), Position = as.numeric(unlist(predict_reset[12,]$asr_b_rewarded[[1]][2])))

```

1. First make LM 

```{r}
lm_encoding_bins <- function(df){
  lm_encoding <- lm(Rates ~ Position, data = df, na.action=na.exclude)
}

```

2. Filter for the location you are interested in initially running the LM on (non-predicted portion)

```{r}
df_start <- df %>% filter(between(Position, 30, 90))
lm <- lm_encoding_bins(df_start)
```

3. Make new dataset of locations we want to predict firing rate for

```{r}

lm_predict <- function(df){
  new.data <- data.frame(Position =df$Position)
}

```

4. Use R's predict() function to predict firing rates from new data

```{r}
df_end <- df %>% filter(between(Position, 110, 170))
new.data <- lm_predict(df_end)
Rates <- predict(lm, newdata = new.data)
mydata <- cbind(new.data, Rates)

```




Now want to see how the predicted firing rate maps to real firing rate

1. run LM for real firing rate 

```{r}
lm_real <- lm_encoding_bins(df_end)
summary(lm_real)

```

2. Run LM for predictive firing rates

```{r}

lm_predict <- lm_encoding_bins(mydata)
summary(lm_predict)

```


Plot real and predicted LM results

```{r}
ggplot(lm_real$model, aes_string(x = names(lm_real$model)[2], y = names(lm_real$model)[1])) + 
  geom_point() +
  coord_cartesian(xlim = NULL, ylim = c(-5,15)) +
  stat_smooth(method = "lm", col = "red") 

```

```{r}
ggplot(lm_predict$model, aes_string(x = names(lm_predict$model)[2], y = names(lm_predict$model)[1])) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") 
```

Compare the real and predictive models via an anova
```{r}
anova(lm_real, lm_predict)
```


```{r}
compareLM(lm_real, lm_predict)
```


```{r}
coefficients(lm_real)[1] 
coefficients(lm_predict)[1] 
```

